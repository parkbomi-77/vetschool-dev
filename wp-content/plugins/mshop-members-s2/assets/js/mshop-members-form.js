jQuery(document).ready(function($){$.fn.form.settings.rules.validatePasswordStrengthAllowEmpty=function(a){return""===a||4===wp.passwordStrength.meter(a,wp.passwordStrength.userInputDisallowedList(),a)},$.fn.form.settings.rules.validatePasswordStrength=function(a){return 4===wp.passwordStrength.meter(a,wp.passwordStrength.userInputDisallowedList(),a)},$.fn.form.settings.rules.g_recaptcha_response=function(a){return 4===wp.passwordStrength.meter(a,wp.passwordStrength.userInputDisallowedList(),a)},$.fn.MFD_FIELD_PHONE=function(a){if("object"==typeof(a=a||{}))return this.each(function(){var b=$.extend({name:$(this).data("element_name"),form_slug:$(this).data("form_slug")},a);new mfdFieldPhone($(this),b)}),this;throw new Error("잘못된 호출입니다.: "+a)};var mfdFieldPhone=function(a,b){void 0===a.data("mfd")&&(this.$element=a,this.options=b,this._init(),this._registerHandler(),a.data("mfd",this))};mfdFieldPhone.prototype._init=function(){this.$requestForm=$(".phone-number-wrapper",this.$element),this.$verificationForm=$(".verification-wrapper",this.$element),this.$requestButton=$(".phone-certification",this.$element),this.$verificationButton=$(".phone-verification",this.$element),this.$certificationNumber=$("[name=certification_number]",this.$element),this.$verifiedNumber=$("[name="+this.options.name+"_certification_number]",this.$element),this.$findLogin=$("[name="+this.options.name+"_find_login]",this.$element),this.$allowDuplicate=$("[name="+this.options.name+"_allow_duplicate]",this.$element),this.$userLogin=$("[name="+this.options.name+"_user_login]",this.$element),this.$temporaryPassword=$("[name="+this.options.name+"_temporary_password]",this.$element),this.timerOption={}},mfdFieldPhone.prototype._registerHandler=function(){$(".phone-part",this.$element).on("change",this._assemblePhoneNumber.bind(this)),this.$requestButton.on("click",this._showVerificationForm.bind(this)),this.$verificationButton.on("click",this._verifyCertificationNumber.bind(this))},mfdFieldPhone.prototype._assemblePhoneNumber=function(){var a=[];a.push($("[name=part1]",this.$element).val().trim()),a.push($("[name=part2]",this.$element).val().trim()),a.push($("[name=part3]",this.$element).val().trim()),4===a[1].length&&4===a[2].length?$("input[name="+this.options.name+"]",this.$element).val(a.join("-")):$("input[name="+this.options.name+"]",this.$element).val("")},mfdFieldPhone.prototype._verifyCertificationNumber=function(){CryptoJS.MD5(this.$certificationNumber.val()).toString()===_msm.certification_hash?(this._clearTimer(),this.$verifiedNumber.val(this.$certificationNumber.val()),this.$verificationForm.addClass("disabled hidden"),this.$requestButton.val("인증완료"),alert("인증이 완료되었습니다")):alert("올바르지 않은 인증번호입니다.")},mfdFieldPhone.prototype._startTimer=function(){this.$certificationNumber.attr("placeholder","인증번호 유효 시간 : 03:00"),this.timerOption={start:new Date,limit:new Date(18e4)},this.timer=setInterval(function(){var a=new Date,b=a-this.timerOption.start,c=1e3*Math.ceil((this.timerOption.limit-b)/1e3);if(c<=0)this._reset();else{var d=new Date(c);this.$certificationNumber.attr("placeholder","인증번호 유효 시간 : "+d.toTimeString().substr(3,5))}}.bind(this),1e3)},mfdFieldPhone.prototype._clearTimer=function(){this.timer&&(clearInterval(this.timer),this.timer=null)},mfdFieldPhone.prototype._reset=function(){this._clearTimer(),this.$requestForm.removeClass("disabled"),this.$verificationForm.addClass("hidden"),_msm.certification_hash=""},mfdFieldPhone.prototype._showVerificationForm=function(){var a=$("input[name="+this.options.name+"]",this.$element).val();return"yes"===this.$temporaryPassword.val()&&_.isEmpty(this.$userLogin.val())?void alert("아이디 또는 이메일을 입력해주세요."):_.isEmpty(a)?void alert("전화번호를 입력해주세요"):(this.$requestForm.hasClass("disabled")||(this.$requestForm.addClass("disabled"),this.$userLogin.closest(".fields").addClass("disabled")),this.$element.closest(".form").addClass("loading"),void $.ajax({url:_msm.ajaxurl,type:"POST",data:{action:_msm.slug+"-request_certificate_number",phone_number:$("input[name="+this.options.name+"]",this.$element).val(),find_login:this.$findLogin.val(),allow_duplicate:this.$allowDuplicate.val(),temporary_password:this.$temporaryPassword.val(),user_login:this.$userLogin.val(),form_slug:this.options.form_slug,_wpnonce:_msm._wpnonce},success:function(a){a&&a.success?!_.isUndefined(a.data.already_certified)&&a.data.already_certified?(this.$verifiedNumber.val(a.data.certification_hash),this.$requestButton.val("인증완료"),alert("인증이 완료된 휴대폰입니다.")):(this._startTimer(),this.$verificationForm.removeClass("hidden"),_msm.certification_hash=a.data.certification_hash):(this.$requestForm.removeClass("disabled"),this.$userLogin.closest(".fields").removeClass("disabled"),alert(a.data)),this.$element.closest(".form").removeClass("loading")}.bind(this)}))},$.fn.membersForm=function(a){if("object"==typeof(a=a||{}))return this.each(function(){var b=$.extend({totalCount:1,formIndex:1,wrapper:$(document)},a);new msmForm($(this),b)}),this;throw new Error("잘못된 호출입니다.: "+a)};var msmForm=function(a,b){void 0===a.data("msmForm")&&(this.$wrapper=b.wrapper,this.$element=a,this.options=b,this._init(),a.data("msmForm",this))};msmForm.prototype._init=function(){this.$form=$("form",this.$element),this.$message=$(".mshop-members-message",this.$element),this.formID=this.$form.data("id"),this.formType=this.$form.data("type"),this.errorPopup="yes"===this.$form.data("error_popup"),this.formArgs=eval("mfs_form_"+this.formID),$(".ui.checkbox",this.$form).checkbox(),!1!==$("div.mfs_form").triggerHandler("msm-form-"+this.formType,this)&&(this._initConditionalRules(),this._bindEvent(),this._initAgreementForm(),this._initDefaultFormAction(),this.$form.trigger("msm-form-controller-init",this)),$(".msm-tooltip",this.$form).popup({inline:!0})},msmForm.prototype.alert=function(a,b){_.isEmpty(a)||$.confirm({title:"",content:a,type:b?"blue":"red",boxWidth:_msm.is_mobile?"90%":"500px",useBootstrap:!1,animation:"none",buttons:{cancel:{text:"확인"}}})},msmForm.prototype._bindEvent=function(){$(".load-msm-form",this.$form).on("click",this._loadMembersForm.bind(this))},msmForm.prototype._loadMembersForm=function(a){a.preventDefault(),a.stopPropagation();const b=this;b.$form.addClass("loading"),$.ajax({type:"POST",url:b.formArgs.ajaxurl,data:{action:_msm.slug+"-load_members_form",form_slug:$(a.target).data("form"),_wpnonce:_msm._wpnonce},success:function(a){a.success&&(b.$wrapper.html(a.data),b.$wrapper.members(),_.each($("div.phone-field"),function(a,b){$(a).MFD_FIELD_PHONE()})),b.$form.removeClass("loading"),$(document).trigger(" members-form-loaded")}})},msmForm.prototype._initConditionalRules=function(){var a=this;$(".conditional_trigger.field input",this.$form).on("change",function(){if("disabled"!==$(this).attr("disabled")){var b=$(this).attr("name"),c=$(this).val().split(",");if("checkbox"===$(this).prop("type")&&(c=[$(this).is(":checked")?"on":"off"]),"radio"===$(this).prop("type")&&!$(this).is(":checked"))return;var d=$(".show-if.show-if-"+b,a.$form),e=$(".hide-if.hide-if-"+b,a.$form);d.css("display","none"),e.css("display","block"),$("input, select",d).attr("disabled","disabled"),$("input, select",e).removeAttr("disabled"),$.each(c,function(c,d){var e=$(".show-if.show-if-"+b+".show-if-"+b+"-"+d+":not(.combination)",a.$form),f=$(".hide-if.hide-if-"+b+".hide-if-"+b+"-"+d+":not(.combination)",a.$form);e.css("display","block"),f.css("display","none"),$("input, select",e).removeAttr("disabled"),$("input, select",f).attr("disabled","disabled")});var f=c.sort().join("-"),g=$(".show-if.show-if-"+b+".show-if-"+b+"-"+f+".combination",a.$form);g.css("display","block"),$("input, select",g).removeAttr("disabled")}}),$(".conditional_trigger.field input",this.$form).trigger("change")},msmForm.prototype._initAgreementForm=function(){const a=this;($(".ui.checkbox.agree_all",this.$form).length>0||$(".agreement-item",this.$form).length>0)&&($(".ui.checkbox.agree_all",this.$form).checkbox({onChecked:function(b){setTimeout(function(){$(".ui.checkbox.agreement-item",a.$form).checkbox("set checked")},100),_.isUndefined(b)||(b.stopPropagation(),b.preventDefault())},onUnchecked:function(b){setTimeout(function(){$(".ui.checkbox.agreement-item",a.$form).checkbox("set unchecked")},100),_.isUndefined(b)||(b.stopPropagation(),b.preventDefault())}}),$(".agreement-item",this.$form).checkbox({onChecked:function(b){$(".agreement-item input[type=checkbox]",a.$form).length===$(".agreement-item input[type=checkbox]:checked",a.$form).length&&$(".agree_all",a.$form).checkbox("set checked"),event.stopPropagation(),event.preventDefault()},onUnchecked:function(b){$(".agree_all",a.$form).checkbox("set unchecked"),event.stopPropagation(),event.preventDefault()}}),$("div.accordion",this.$form).accordion({animateChildren:!1,duration:0}))},msmForm.prototype._initDefaultFormAction=function(){var a=function(a,b){this.alert($.unique(a).join("<br>"))}.bind(this),b=function(){if($("body").trigger("msm-before-submit"),this.options.formIndex<this.options.totalCount)this.$wrapper.trigger("next");else{var a=this,b="",c=[],d=new FormData;d.append("action",_msm.slug+"-submit"),$.each($("div.mfs_form form",this.$wrapper),function(a,e){var f=$(e).data("id"),g=$(e).serialize();b+="&form_"+f+"="+encodeURI(g),c.push(f),d.append("form_"+f,encodeURI(g)),$.each(e.elements,function(a,b){"file"===$(b).attr("type")&&$.each(b.files,function(a,c){d.append($(b).attr("name")+"#"+a,c)})})}),d.append("form_ids",c.join(",")),d.append("msm_nonce",this.formArgs.msm_nonce),$(this.$message).empty(),$(this.$form).addClass("loading"),$.ajax({url:this.formArgs.ajaxurl,type:"POST",data:d,cache:!1,dataType:"json",processData:!1,contentType:!1,success:function(b){b.success?b.data&&(b.data._msm_postid&&$("input[name=_msm_postid]",this.form).val(b.data._msm_postid),b.data.message&&$(a.$message).append('<div class="ui small positive message">'+b.data.message+"</div>"),""!==a.formArgs.redirectURL?window.location.replace(a.formArgs.redirectURL):void 0!==b.data.redirect_url?""===b.data.redirect_url?window.location=window.location.href:window.location.replace(b.data.redirect_url):void 0!==b.data.trigger?$("body").trigger(b.data.trigger,a):$(a.$form).removeClass("loading")):(b.data&&(b.data._msm_postid&&$("input[name=_msm_postid]",this.form).val(b.data._msm_postid),b.data.message&&$(a.$message).append('<div class="ui small negative message">'+b.data.message+"</div>")),$(a.$form).removeClass("loading"))}})}}.bind(this);this.errorPopup?$(this.$form).form({onSuccess:b,onFailure:a,fields:JSON.parse(this.formArgs.fieldRules)}):$(this.$form).form({onSuccess:b,fields:JSON.parse(this.formArgs.fieldRules)}),$(this.$form).find("input[type=text]").length},$.fn.members=function(){_.each($(this),function(a){var b=$(".mfs_form",$(a)),c=$(".mfs_wrapper",$(a));if(_.each(b,function(c,d){$(c).membersForm({totalCount:b.length,formIndex:d+1,wrapper:$(a)})}),c.length>0){var d=c.find("div.mfs_item"),e=Math.min(d.length,b.length),f=0;$(d[0]).addClass("active"),$(a).on("next",function(){f<e&&($(d[f]).removeClass("active").addClass("completed"),$(b[f++]).css("display","none"),$(d[f]).addClass("active"),$(b[f]).fadeIn())}).on("prev",function(){f>0&&($(d[f]).removeClass("active"),$(b[f--]).css("display","none"),$(d[f]).addClass("active").removeClass("completed"),$(b[f]).fadeIn())})}})},$(document).bind("fragment_updated",function(a,b){if(_.intersection(b,["login"]).length>0){var c=$(".memberswrap");0===c.length&&(c=$(document)),c.members()}}),$(document).trigger("fragment_updated",[["login"]]),_.each($("div.phone-field"),function(a,b){$(a).MFD_FIELD_PHONE()});var formController=function(){this.form=null,this.form_id="",this.index=0,this.count=0,this.form_args=null,this.form=null,this.message=null,this.initCertification=function(){if($(".mshop-ipin-certification",this.form).length>0||$(".mshop-checkplus-certification",this.form).length>0){var a=this,b=function(b,c,d){$("#mshop_auth_method",a.$form).val(c),$("#mshop_auth_data",a.$form).val(d),setTimeout(function(){alert("본인인증에 성공했습니다."),$(".ui.checkbox.user_certification",a.$form).length>0?$(".ui.checkbox.user_certification",a.$form).checkbox("set checked"):a.$form.submit()})};$("body").on("MShopUserCertificationSuccess",b),$(".mshop-ipin-certification",this.form).unbind("click"),$(".mshop-ipin-certification",this.form).on("click",function(){document.form_ipin?(window.open("","popupIPIN2","width=450, height=550, top=100, left=100, fullscreen=no, menubar=no, status=no, toolbar=no, titlebar=yes, location=no, scrollbar=no"),document.form_ipin.target="popupIPIN2",document.form_ipin.action="https://cert.vno.co.kr/ipin.cb",document.form_ipin.submit()):alert("아이핀 인증정보를 확인할 수 없습니다.")}),$(".mshop-checkplus-certification",this.form).unbind("click"),$(".mshop-checkplus-certification",this.form).on("click",function(){document.form_chk?(window.open("","popupChk","width=500, height=550, top=100, left=100, fullscreen=no, menubar=no, status=no, toolbar=no, titlebar=yes, location=no, scrollbar=no"),document.form_chk.action="https://nice.checkplus.co.kr/CheckPlusSafeModel/checkplus.cb",document.form_chk.target="popupChk",document.form_chk.submit()):alert("아이핀 인증정보를 확인할 수 없습니다.")})}},this.initWritePostForm=function(){var a=function(){if(this.index<this.count)$(msfd_wrapper).trigger("next");else{var a=this,b="",c=[],d=new FormData;d.append("action",_msm.slug+"-submit"),$.each($("div.mfs_form form"),function(a,e){var f=$(e).data("id"),g=$(e).serialize();b+="&form_"+f+"="+encodeURI(g),c.push(f),d.append("form_"+f,encodeURI(g)),$.each(e.elements,function(a,b){"file"===$(b).attr("type")&&$.each(b.files,function(a,c){d.append($(b).attr("name")+"#"+a,c)})})}),d.append("form_ids",c.join(",")),d.append("msm_nonce",this.form_args.msm_nonce),$(a.$message).empty(),$(this.form).addClass("loading"),$.ajax({url:this.form_args.ajaxurl,type:"POST",data:d,cache:!1,dataType:"json",processData:!1,contentType:!1,success:function(b){b.success?b.data&&(b.data.message&&$(a.$message).append('<div class="ui small positive message">'+b.data.message+"</div>"),""!==a.formArgs.redirectURL?window.location=a.formArgs.redirectURL:void 0!==b.data.redirect_url?""===b.data.redirect_url?window.location=window.location.href:window.location.replace(b.data.redirect_url):$(a.$form).removeClass("loading")):($(a.$message).append('<div class="ui small negative message">'+b.data+"</div>"),$(a.$form).removeClass("loading"))}})}}.bind(this);$(this.form).form({onSuccess:a,fields:JSON.parse(this.form_args.fieldRules)}),$(this.form).find("input[type=text]").length>0&&$(this.form).find("input[type=text]")[0].focus()}}});